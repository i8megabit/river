# –ú–µ—Ö–∞–Ω–∏–∑–º –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤

## –û–±–∑–æ—Ä

–í–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à-id, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –æ—Ç—á–µ—Ç–æ–≤ –æ—Ç –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Å–∏—Å—Ç–µ–º—ã.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö–µ—à–∞ –æ—Ç—á–µ—Ç–∞

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç—á–µ—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ö–µ—à –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- –ò–º–µ–Ω–∏ —Ö–æ—Å—Ç–∞ —Å–∏—Å—Ç–µ–º—ã
- –ù–∞–∑–≤–∞–Ω–∏—è –∏ –≤–µ—Ä—Å–∏–∏ –û–°
- –ö–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, TCP/UDP –ø–æ—Ä—Ç–æ–≤)

```python
# –ü—Ä–∏–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ö–µ—à–∞:
hash_components = [
    'my-server',           # hostname
    'macOS',              # os_name
    '14.5.0',            # os_version
    '15',                # total_connections
    '8',                 # tcp_ports_count
    '3'                  # udp_ports_count
]
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞:
1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ö–µ—à –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –µ—Å—Ç—å –ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç —Å —Ç–∞–∫–∏–º –∂–µ —Ö–µ—à–µ–º
3. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç - —Å—Ç–∞—Ä—ã–π –æ—Ç—á–µ—Ç —É–¥–∞–ª—è–µ—Ç—Å—è (—Ñ–∞–π–ª + –∑–∞–ø–∏—Å—å –≤ –ë–î)
4. –ù–æ–≤—ã–π –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å —Ç–µ–º –∂–µ —Ö–µ—à-id

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í —Ç–∞–±–ª–∏—Ü—É `system_reports` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ:
```sql
report_hash VARCHAR(64) UNIQUE NOT NULL
```

–° –∏–Ω–¥–µ–∫—Å–∞–º–∏:
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `report_hash`
- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `(hostname, report_hash)`

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–∞ —á–µ—Ä–µ–∑ API

```bash
curl -X POST "http://localhost:8000/api/v1/reports/upload" \
     -F "file=@my_report.html"
```

–û—Ç–≤–µ—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ:
```json
{
    "message": "–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω",
    "report_id": "12345678-1234-5678-9abc-123456789012",
    "report_hash": "a1b2c3d4e5f6789a",
    "filename": "my_report.html",
    "saved_as": "report_a1b2c3d4e5f6789a.html",
    "hostname": "my-server",
    "is_replacement": false
}
```

–û—Ç–≤–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥—É–±–ª–∏–∫–∞—Ç–∞:
```json
{
    "message": "–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω (–∑–∞–º–µ–Ω–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç)",
    "report_id": "87654321-4321-8765-cba9-876543210987",
    "report_hash": "a1b2c3d4e5f6789a",
    "filename": "my_report_updated.html",
    "saved_as": "report_a1b2c3d4e5f6789a.html",
    "hostname": "my-server",
    "is_replacement": true,
    "replaced_report": {
        "id": "12345678-1234-5678-9abc-123456789012",
        "hostname": "my-server",
        "generated_at": "2024-12-27T10:30:00"
    }
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Ç—á–µ—Ç–æ–≤

```bash
curl "http://localhost:8000/api/v1/reports"
```

–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö–µ—à–µ:
```json
{
    "reports": [
        {
            "id": "87654321-4321-8765-cba9-876543210987",
            "hostname": "my-server",
            "filename": "report_a1b2c3d4e5f6789a.html",
            "report_hash": "a1b2c3d4e5f6789a",
            "total_connections": 15,
            "tcp_ports_count": 8,
            "udp_ports_count": 3
        }
    ],
    "total": 1
}
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
cd analyzer-platform/backend
python apply_migration.py
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã:
```bash
pip install beautifulsoup4 hashlib
```

### 3. –ó–∞–ø—É—Å–∫ –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

```bash
cd analyzer-platform
docker-compose up -d
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
python test_deduplication.py
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–µ—Å—Ç—ã:
1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞
2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞ (–¥–æ–ª–∂–µ–Ω –∑–∞–º–µ–Ω–∏—Ç—å –ø–µ—Ä–≤—ã–π)
3. –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–∞ —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π)
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```python
def generate_report_hash(file_path, metadata=None):
    hash_components = [
        metadata.get('hostname', 'unknown'),
        metadata.get('os_name', ''),
        metadata.get('os_version', ''),
        str(metadata.get('total_connections', 0)),
        str(metadata.get('tcp_ports_count', 0)),
        str(metadata.get('udp_ports_count', 0)),
    ]
    
    hash_string = '|'.join(str(component).strip() for component in hash_components)
    hash_object = hashlib.sha256(hash_string.encode('utf-8'))
    return hash_object.hexdigest()[:16]  # –ü–µ—Ä–≤—ã–µ 16 —Å–∏–º–≤–æ–ª–æ–≤
```

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –∏–º–µ–Ω–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞:
```
report_{hash}.html
```

–ù–∞–ø—Ä–∏–º–µ—Ä: `report_a1b2c3d4e5f6789a.html`

### –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞ —Å –¥—É–±–ª–∏–∫–∞—Ç–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è:
- –ó–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `system_reports`
- –°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü `network_connections`, `network_ports`, etc.
- –§–∞–π–ª –æ—Ç—á–µ—Ç–∞ —Å –¥–∏—Å–∫–∞

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–º–µ–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
2. **–≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞**: –ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
3. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**: –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –æ—Ç—á–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏—Å—Ç–µ–º—ã
4. **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ö–µ—à—É
5. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º**: –î–∞–∂–µ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–π —Ö–µ—à
2. **–ö–æ–ª–ª–∏–∑–∏–∏ —Ö–µ—à–µ–π**: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã, –Ω–æ –∫—Ä–∞–π–Ω–µ –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω—ã
3. **–¢—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏**: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ "report_hash field missing"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è:
```bash
python apply_migration.py
```

### –î—É–±–ª–∏–∫–∞—Ç—ã –≤—Å–µ –µ—â–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ö–µ—à–∞:
```bash
docker-compose logs backend
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º HTML

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ HTML –æ—Ç—á–µ—Ç—ã –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏:
- `<title>–ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π –æ—Ç—á–µ—Ç –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ - {hostname}</title>`
- `<div class="header-info-item">üíª –û–°: {os_name}</div>`
- `<div class="stat-number">{connections}</div>` 